## 성능 분석 단계

1. 원하는 결과 정의
2. 기존 시스템 측정
3. 요건을 충족시킬 수 있는 변수 정의
4. 개선 활동 추진
5. 다시 테스트 진행
6. 목표가 달성됐는지 판단

## 성능 지표

### 처리율

- 서브 시스템이 수행 가능한 작업의 비율을 나타낸 지표
- 보통 일정 시간 동안 완료한 작업 단위 수 (초당 처리 가능한 트랜잭션 수)
- 처리율을 측정한 하드웨어 스펙, OS, 소프트웨어 스택, 단일 서버인지 클러스터 환경인지 기술해야 실제 성능을 반영한 의미있는 지표가 될 수 있다.
- 트랜잭션은 테스트할 때마다 동일해야 한다

### 지연

- 하나의 트랜잭션을 처리하는데 소요된 시간
- 종단 시간이라고도한다.

### 용량

- 시스템이 동시 처리 가능한 작업 개수
- 용량은 어떤 처리율 또는 지연 값을 전제로 가능한 처리량으로 표시한다.

### 사용률

- 리소스 사용률

### 효율

- 효율 = 처리율 / 리소스 사용률

### 확장성

- 리소스 추가에 따른 처리율의 변화
- 예를 들어 클러스터를 2배로 늘림 → 트랜잭션 처리량도 2배 늘었다면 완벽한 선형 확장을 달성한 시스템
- 보통 시스템 확장성은 여러가지 인자들의 영향을 받으므로 현실적으로 선형 확장을 달성하기는 매우 어려움

### 저하

- 시스템이 풀가동 된 상태면 → 처리율이 더 늘어 나지 않고, 지연이 증가하는데 이런 현상을 부하 증가에 따른 저하라고 한다.

### 측정값 사이의 연관관계

- 부하 증가로 인해 시스템 양상이 어떻게 달라지는 지를 반영하는 값으로 확장성과 저하가 있다.
    - 확장성을 감안하면 부하가 늘 때 가용 리소스도 함께 늘려야 하는데 → 시스템이 확장한 리소스를 제대로 활용할 수 있을지가 관건
    - 부하는 증가했는데 → 리소스 그대로면 → 저하되는 측정값이(지연) 있을 것이다.
    - 예시 : 핫스팟 JIT 컴파일러
        - 부하가 적을 경우 핵심 메서드 → 인터프리터 모드로 실행된다
        - 부하가 많아서 메서드 호출 빈도가 증가해서 JIT 컴파일 대상이 되면 → 같은 메서드지만 나중에 호출하는 게 처음보다 더 빨리 실행된다.

### 핫스팟 JIT 컴파일러 예시를 좀 더 살펴 보면

- **자바는 처음에 인터프리터 모드로 실행**
    - 자바는 처음에 코드를 한줄 한줄 해석하는 인터프리터 모드로 실행된다
    - 인터프리터는 기계어로 바로 번역하지 않고, 자바 바이트 코드를 읽고 바로 실행하기 때문에 처음에는 속도가 느릴 수 밖에 없음
- **JIT 컴파일러가 동작하면**
    - 메서드가 자주 호출되면 → JIT 컴파일 대상이 된다
    - 한번 번역된 메서드는 이후 실행할 때는 속도가 아주 빠르다
- **JIT 컴파일러가 동작하는 조건**
    - 충분히 빈번하게 호출되어야 한다. 그래서 자주 호출되는지 확인할 때 까지는 인터프리터 모드로 계속실행시킨다.
- **부하에 따른 차이**
    - 프로그램 부하가 적을 때 : 요청이 적고, 메서드 호출이 드물게 된다.
        - 호출이 잦지 않으므로, 인터프리터 모드로 실행 → 느린 상태로 계속 실행
    - 프로그램 부하가 많을 때 : 요청이 많고, 메서드 호출이 자주 된다.
        - JIT 컴파일이 트리거 되고 → 기계어로 번역되면 이후 빠르게 실행

### 자바 컴파일 순서

- **소스코드 컴파일 단계** : 소스코드 → 바이트 코드로 컴파일
    - 자바 소스파일(.java)을 javac 컴파일러가 바이트코드(.class 파일)로 변환한다.
    - .java → (javac 컴파일) → .class
- **바이트코드 실행 단계** : 바이트코드(.class 파일)를 JVM이 받아서 실행한다
    - JVM은 바이트 코드 실행할 때
        - 인터프리터 모드로 실행하다
        - 자주 호출되는 메서드만 JIT 컴파일해서 기계어로 변환한다